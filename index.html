<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Turnstile with IP Auto-Target</title>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <script src="https://api.ipify.org?format=jsonp&callback=onIpLoaded" defer></script>
</head>
<body>
  <h2>âœ… Solve Turnstile Challenge Below</h2>
  <div class="cf-turnstile"
       data-sitekey="0x4AAAAAABgllIL-fmIGImj5"
       data-callback="onSuccess">
  </div>

  <script>
    let clientIP = "unknown";
    let serverIP = "127.0.0.1";  // default fallback

    function onIpLoaded(data) {
      clientIP = data.ip;
      serverIP = data.ip;
      console.log("ğŸ“¡ Your public IP:", clientIP);
    }

    function onSuccess(token) {
      const endpoint = `http://${serverIP}:5000/save-token`;
      console.log("ğŸ”— Sending to:", endpoint);
      console.log("ğŸ§  Token:", token);

      fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, ip: clientIP })
      })
      .then(res => {
        if (res.ok) alert("âœ… Token and IP sent to server!");
        else alert("âŒ Server error. Check console.");
      })
      .catch(err => {
        console.error("âŒ Network error:", err);
        alert("âŒ Could not reach your backend server.");
      });
    }
  </script>
</body>
</html>
